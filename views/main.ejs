<!DOCTYPE html>
<html lang="ja">
    <head>
        <title>TODOリスト</title>
        <%-include('./header')%>
        <script type="text/javascript" src="/javascripts/main.js"></script>
        <link rel="stylesheet" href="/stylesheets/main.css">
    </head>
    <body>
    <div id="wrap">
        <article>
        <h1>TODOリスト</h1>
        <p><%=message%></p>
        <form action="/main/new" method="post">
            <input type="text" name="content" placeholder="日本語と英数字のみ対応" required>
            <select name="attribute">
                <option value="m" selected>しないといけないこと</option>
                <option value="w">やりたいこと</option>
                <option value="e">そのうちすること</option>
            </select>
            <button type="submit">送信</button>
        </form>
        
        <section>
        <div class="must">
            <h3>しないといけないこと</h3>
            <div class="list">
            <% for(let i = 0;i < m[0].length;i++){ %>
                <input class="list-checkbox" type="checkbox" value=<%= m[1][i]%>><p class="list-content" draggable="true"><%= m[0][i] %></p>
            <% } %>
            </div>
        </div>
        </section>

        <section>
        <div class="want">
            <h3>やりたいこと</h3>
            <div class="list">
            <% for(let i = 0;i < w[0].length;i++){ %>
                <input class="list-checkbox" type="checkbox" value=<%= w[1][i]%>><p class="list-content" draggable="true"><%= w[0][i] %></p>
            <% } %>
            </div>
        </div>
        </section>

        <section>
        <div class="eventually">
            <h3>そのうちすること</h3>
            <div class="list">
            <% for(let i = 0;i < e[0].length;i++){ %>
                <input class="list-checkbox" type="checkbox" value=<%= e[1][i]%>><p class="list-content" draggable="true"><%= e[0][i] %></p>
            <% } %>
            </div>
        </div>
        </section>

        </article>
    </div>
    </body>
    <script type="text/javascript" src="/javascripts/jquery.js"></script>
    <script type="text/javascript" src="/javascripts/jquery-ui.min.js"></script>
    <script>
        // jqueryが外部ファイルで読み込まれないため仕方なし
        $(function() {
            $('.list-content').draggable();
            $('.list').droppable({
                over: function(e,ui) {
                    $(this)
                    .css('background', '#e0ffff')
                    .css('border', '2px solid #00bfff')
                }
            });

            $('.list-checkbox').on('click',function(){
                let thisEl = $(this);
                setTimeout(function(){
                    thisEl.css({'display':'none'});
                    thisEl.next('p').css({'display':'none'});
                    $.ajax({
                        url:'/main/end',
                        type:'POST',
                        data:{
                            'id': thisEl.attr("value")
                        }
                    })
                    .done(data => {
                        console.log(data);
                    })
                    .fail(data => {
                        console.log(data);
                    })
                    .always(data => { 

                    });
                },1000);
            });
        });
    </script>
</html>